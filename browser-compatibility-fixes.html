<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#1e40af">
  <title>WorkLink Command Center</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/admin/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/admin/favicon-16x16.png">
  <link rel="icon" type="image/png" href="/admin/favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/admin/apple-touch-icon.png">

  <!-- Browser Compatibility Detection and Fixes -->
  <script>
    // 1. Browser Compatibility Detection
    (function() {
      var isSupported = true;
      var unsupportedReasons = [];

      // Check for ES6 module support
      if (!('noModule' in HTMLScriptElement.prototype)) {
        isSupported = false;
        unsupportedReasons.push('ES6 modules not supported');
      }

      // Check for essential JavaScript features
      try {
        // Check Symbol support
        if (typeof Symbol === 'undefined') {
          isSupported = false;
          unsupportedReasons.push('Symbol not supported');
        }

        // Check Promise support
        if (typeof Promise === 'undefined') {
          isSupported = false;
          unsupportedReasons.push('Promise not supported');
        }

        // Check fetch support
        if (typeof fetch === 'undefined') {
          isSupported = false;
          unsupportedReasons.push('fetch API not supported');
        }

        // Check for arrow function support
        eval('(() => {})');
      } catch (e) {
        isSupported = false;
        unsupportedReasons.push('Modern JavaScript syntax not supported');
      }

      // Check for essential CSS features
      if (!CSS.supports || !CSS.supports('display', 'flex')) {
        isSupported = false;
        unsupportedReasons.push('CSS Flexbox not supported');
      }

      // Store compatibility info globally
      window.browserCompatibility = {
        isSupported: isSupported,
        reasons: unsupportedReasons,
        userAgent: navigator.userAgent,
        isIE: /MSIE|Trident/.test(navigator.userAgent),
        isOldChrome: /Chrome\/([0-9]+)/.test(navigator.userAgent) && parseInt(RegExp.$1) < 61,
        isOldFirefox: /Firefox\/([0-9]+)/.test(navigator.userAgent) && parseInt(RegExp.$1) < 60,
        isOldSafari: /Safari\//.test(navigator.userAgent) && /Version\/([0-9]+)/.test(navigator.userAgent) && parseInt(RegExp.$1) < 11
      };

      // Show unsupported browser message if needed
      if (!isSupported) {
        document.addEventListener('DOMContentLoaded', function() {
          showUnsupportedBrowserMessage();
        });
      }
    })();

    // 2. Polyfill Loading
    function loadPolyfills() {
      var polyfillsNeeded = [];

      // Check what polyfills are needed
      if (!window.Promise) polyfillsNeeded.push('promise');
      if (!window.Symbol) polyfillsNeeded.push('symbol');
      if (!window.fetch) polyfillsNeeded.push('fetch');
      if (!Array.from) polyfillsNeeded.push('array');
      if (!Object.assign) polyfillsNeeded.push('object');

      // Load polyfills if needed
      if (polyfillsNeeded.length > 0) {
        var polyfillScript = document.createElement('script');
        polyfillScript.src = 'https://polyfill.io/v3/polyfill.min.js?features=' + polyfillsNeeded.join(',');
        polyfillScript.onload = function() {
          console.log('Polyfills loaded for:', polyfillsNeeded);
          initializeApp();
        };
        polyfillScript.onerror = function() {
          console.error('Failed to load polyfills');
          showPolyfillErrorMessage();
        };
        document.head.appendChild(polyfillScript);
      } else {
        initializeApp();
      }
    }

    // 3. App Initialization
    function initializeApp() {
      // Only initialize if browser is supported
      if (window.browserCompatibility && window.browserCompatibility.isSupported) {
        console.log('Browser is supported, initializing React app...');
        loadModernApp();
      } else {
        console.warn('Browser not fully supported, showing fallback UI');
        showUnsupportedBrowserMessage();
      }
    }

    // 4. Modern App Loading
    function loadModernApp() {
      // Load the main React application
      var script = document.createElement('script');
      script.type = 'module';
      script.crossOrigin = true;
      script.src = '/admin/assets/index-BVl2aEAL.js';
      script.onerror = function(e) {
        console.error('Failed to load main app:', e);
        showLoadingErrorMessage();
      };

      // Also load CSS
      var css = document.createElement('link');
      css.rel = 'stylesheet';
      css.crossOrigin = true;
      css.href = '/admin/assets/index-C8AAwRyk.css';
      css.onerror = function() {
        console.warn('Failed to load CSS, continuing without styles');
      };

      document.head.appendChild(css);
      document.head.appendChild(script);
    }

    // 5. Fallback UI for Unsupported Browsers
    function showUnsupportedBrowserMessage() {
      var root = document.getElementById('root');
      if (root) {
        root.innerHTML = `
          <div style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
          ">
            <div style="
              background: rgba(255, 255, 255, 0.1);
              backdrop-filter: blur(10px);
              border-radius: 20px;
              padding: 40px;
              max-width: 500px;
              box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            ">
              <h1 style="margin: 0 0 20px 0; font-size: 28px; font-weight: 600;">
                Browser Not Supported
              </h1>
              <p style="margin: 0 0 30px 0; font-size: 16px; line-height: 1.5; opacity: 0.9;">
                Your browser doesn't support the modern features required by WorkLink Admin Portal.
                Please upgrade to a newer version or use a different browser.
              </p>

              <div style="margin: 30px 0;">
                <h3 style="margin: 0 0 15px 0; font-size: 18px;">Issues Found:</h3>
                <ul style="
                  text-align: left;
                  margin: 0;
                  padding: 0;
                  list-style: none;
                  background: rgba(0, 0, 0, 0.2);
                  border-radius: 10px;
                  padding: 15px;
                ">
                  ${window.browserCompatibility ?
                    window.browserCompatibility.reasons.map(reason =>
                      '<li style="margin: 5px 0;">• ' + reason + '</li>'
                    ).join('') :
                    '<li>• Browser compatibility check failed</li>'
                  }
                </ul>
              </div>

              <div style="margin: 30px 0 20px 0;">
                <h3 style="margin: 0 0 15px 0; font-size: 18px;">Recommended Browsers:</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;">
                  <a href="https://www.google.com/chrome/" target="_blank" style="
                    display: inline-block;
                    padding: 12px 20px;
                    background: #4285f4;
                    color: white;
                    text-decoration: none;
                    border-radius: 8px;
                    font-weight: 500;
                    transition: background 0.3s;
                  ">Chrome 61+</a>
                  <a href="https://www.mozilla.org/firefox/" target="_blank" style="
                    display: inline-block;
                    padding: 12px 20px;
                    background: #ff7139;
                    color: white;
                    text-decoration: none;
                    border-radius: 8px;
                    font-weight: 500;
                  ">Firefox 60+</a>
                  <a href="https://www.microsoft.com/edge/" target="_blank" style="
                    display: inline-block;
                    padding: 12px 20px;
                    background: #0078d4;
                    color: white;
                    text-decoration: none;
                    border-radius: 8px;
                    font-weight: 500;
                  ">Edge 79+</a>
                </div>
              </div>

              <button onclick="location.reload()" style="
                padding: 12px 24px;
                background: rgba(255, 255, 255, 0.2);
                color: white;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                margin-top: 20px;
              ">
                Try Again
              </button>
            </div>
          </div>
        `;
      }
    }

    // 6. Loading Error Message
    function showLoadingErrorMessage() {
      var root = document.getElementById('root');
      if (root) {
        root.innerHTML = `
          <div style="
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            text-align: center;
          ">
            <div style="
              background: white;
              border-radius: 12px;
              padding: 40px;
              max-width: 500px;
              box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
              border: 1px solid #e2e8f0;
            ">
              <div style="color: #ef4444; font-size: 48px; margin-bottom: 20px;">⚠️</div>
              <h1 style="margin: 0 0 20px 0; font-size: 24px; color: #1e293b;">
                Loading Error
              </h1>
              <p style="margin: 0 0 30px 0; color: #64748b; line-height: 1.6;">
                Failed to load the admin portal. This might be due to network issues
                or server problems. Please check your connection and try again.
              </p>
              <button onclick="location.reload()" style="
                padding: 12px 24px;
                background: #3b82f6;
                color: white;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                margin: 0 10px 10px 0;
              ">
                Reload Page
              </button>
              <button onclick="window.history.back()" style="
                padding: 12px 24px;
                background: #e2e8f0;
                color: #64748b;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
              ">
                Go Back
              </button>
            </div>
          </div>
        `;
      }
    }

    // 7. Polyfill Error Message
    function showPolyfillErrorMessage() {
      var root = document.getElementById('root');
      if (root) {
        root.innerHTML = `
          <div style="
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            text-align: center;
          ">
            <div style="max-width: 500px;">
              <h1 style="color: #ef4444;">Network Error</h1>
              <p>Cannot load required browser compatibility files. Please check your internet connection.</p>
              <button onclick="loadPolyfills()" style="
                padding: 10px 20px;
                background: #3b82f6;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
              ">
                Retry
              </button>
            </div>
          </div>
        `;
      }
    }

    // 8. Global Error Handlers
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.error);

      // Check if it's a module loading error
      if (e.error && e.error.message && e.error.message.includes('import')) {
        console.error('ES module loading error detected');
        if (window.browserCompatibility && !window.browserCompatibility.isSupported) {
          showUnsupportedBrowserMessage();
        } else {
          showLoadingErrorMessage();
        }
      }
    });

    window.addEventListener('unhandledrejection', function(e) {
      console.error('Unhandled promise rejection:', e.reason);

      // Don't show error UI for every promise rejection, but log it
      if (e.reason && e.reason.message && e.reason.message.includes('Loading')) {
        showLoadingErrorMessage();
      }
    });

    // 9. Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadPolyfills);
    } else {
      loadPolyfills();
    }
  </script>

  <!-- Prevent Flash of Unstyled Content -->
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    #root {
      min-height: 100vh;
    }

    /* Loading spinner for modern browsers */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Hide content until JavaScript loads */
    .js-required {
      display: none;
    }
  </style>
</head>
<body>
  <div id="root">
    <!-- Fallback content for users with JavaScript disabled -->
    <noscript>
      <div style="
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
        text-align: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      ">
        <div>
          <h1 style="color: #ef4444;">JavaScript Required</h1>
          <p>WorkLink Admin Portal requires JavaScript to function. Please enable JavaScript in your browser and reload the page.</p>
        </div>
      </div>
    </noscript>

    <!-- Initial loading indicator -->
    <div id="initial-loading" style="
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    ">
      <div style="text-align: center;">
        <div class="loading-spinner" style="margin-bottom: 20px;"></div>
        <p style="color: #64748b; margin: 0;">Loading WorkLink Admin Portal...</p>
        <p style="color: #94a3b8; font-size: 14px; margin: 10px 0 0 0;">
          If this takes too long, your browser might not be supported.
        </p>
      </div>
    </div>
  </div>

  <!-- Hide initial loading once JavaScript starts -->
  <script>
    document.getElementById('initial-loading').style.display = 'none';
  </script>
</body>
</html>